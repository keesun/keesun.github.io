---
layout: post
title: 주키 정하기
date: 2008-01-14 08:04:09.000000000 -08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Chapter 04
tags:
- 주키 설정
- 하이버네이트
meta:
  arkayne-cache-post: |2+







    <!-- BlogGlue Plugin Error -->
    <!-- This page cannot be linked by BlogGlue. -->
    <!-- You need a valid token. Get one at the URL below. -->
    <!-- http://www.blogglue.com/login/ -->

















  arkayne-time-post: '1323093860'
author:
  login: whiteship
  email: whiteship2000@gmail.com
  display_name: 기선
  first_name: 기선
  last_name: 백
---
<h1>Natural key vs Surrgate key</h1>
<ul>
<li>후보키candidate key는 다음과 같은 특징을 가진다.</p>
<ul>
<li>NULL 값을 갖지 않는다.</li>
<li>유일한 값을 갖는다.</li>
<li>값이 절대로 변하지 않는다.</li>
</ul>
</li>
</ul>
<ul>
<li>A natural key is a key with business meaning: an attribute<br />
or combination of attributes that is unique by virtue of its business<br />
semantics.</li>
</ul>
<ul>
<li>Natural key를 주키로 사용해 왔지만, 다음과 같은 문제가 있다.</p>
<ul>
<li>변하지 않고, 고유하면서, 필수인 값을 찾기가 어렵다. 주키 값을 변경하는 작업은 완전 빡쎄며, 인덱스로 사용하기도 적절하지 않다.</li>
<li>주로 복합키로 구성되는데, 이 것들이 보통 쿼리 작성, 스키마 수정, 유지보수를 어렵게 한다.</li>
</ul>
</li>
</ul>
<ul>
<li>그래서 Surrogate key 사용을 추천한다.</p>
<ul>
<li>Surrogate keys have no business meaning—they're unique values generated by the database or application.</li>
</ul>
</li>
</ul>
<h1>key generator 선택하기</h1>
<ul>
<li>Hibernate has several built-in identifier-generation strategies.</li>
</ul>
<table class="confluenceTable">
<tbody>
<tr>
<th class="confluenceTh"> Generator name </th>
<th class="confluenceTh"> JPA Generation Type </th>
<th class="confluenceTh"> Option </th>
<th class="confluenceTh"> 설명 </th>
</tr>
<tr>
<td class="confluenceTd"> native </td>
<td class="confluenceTd"> AUTO </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> 사용하는 DB에 따라서 sequence, hilo, identity를 알아서 선택함. 설정의 이식성을 고려한다면, 이 설정을 사용할 것. </td>
</tr>
<tr>
<td class="confluenceTd"> identity </td>
<td class="confluenceTd"> IDENTITY </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> DB2, MySQL, MS SQL Server, Sybase, HypersonicSQL에 있는 identity 컬럼을 지원한다. long, short, int 타입의 값을 반환함. </td>
</tr>
<tr>
<td class="confluenceTd"> sequence </td>
<td class="confluenceTd"> SEQUENCE </td>
<td class="confluenceTd"> sequence, parameters </td>
<td class="confluenceTd"> DB2, PostgreSQL, Oracle, SAP DB, Mckoi에서<br />
sequence를 생성한다. long, short, int 타입의 값을 반환함. sequence 옵션을 사용해서 시퀀스의 이름을<br />
설정할 수 있고, DDL에 추가할 시퀀스를 만들 때 필요한 추가 세팅이 필요할 때 parameters를 사용함. </td>
</tr>
<tr>
<td class="confluenceTd"> increment </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> 하이버네이트가 동작하면서 테이블의 주키 컬럼 값 중에 최대값을 읽은 다음 새로운 레코드를 추가할 때, 그 값을 1씩 증가시킴. 단일 서버에서 DB에 독립적으로 접근하는 경우 외에는 사용하지 말아라. </td>
</tr>
<tr>
<td class="confluenceTd"> hilo </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> table, column, max_lo </td>
<td class="confluenceTd"> A high/low algorithm is an efficient way to<br />
generate identifiers of type long, given a table and column as a source<br />
of high values. </td>
</tr>
<tr>
<td class="confluenceTd"> seqhilo </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> sequence, parameters, max_lo </td>
<td class="confluenceTd"> named database sequence에서 high 값을 걷는 것을 빼고 hilo와 동일하다. </td>
</tr>
<tr>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> TABLE </td>
<td class="confluenceTd"> table, catalog, schema, pkColumnName, valueColumnName, pkColumnValue, allocationSize </td>
<td class="confluenceTd"> TABLE relies on a database table that holds<br />
the lastgenerated integer primary key value, and each generator is<br />
mapped to one row in this table. </td>
</tr>
<tr>
<td class="confluenceTd"> uuid.hex </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> separator </td>
<td class="confluenceTd"> This generator is a 128-bit UUID (an algorithm that generates identifiers of type string, unique within a network). </td>
</tr>
<tr>
<td class="confluenceTd"> guid </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> This generator provides a database-generated globally unique identifier string on MySQL and SQL Server. </td>
</tr>
<tr>
<td class="confluenceTd"> select </td>
<td class="confluenceTd">&nbsp;</td>
<td class="confluenceTd"> key </td>
<td class="confluenceTd"> This generator retrieves a primary key<br />
assigned by a database trigger by selecting the row by some unique key<br />
and retrieving the primary key value </td>
</tr>
</tbody>
</table>
<div class="code panel" style="border-width: 1px;">
<div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>하이버네이트 identity generator 사용하기</b></div>
<div class="codeContent panelContent">
<pre class="code-java">@Entity<br />@org.hibernate.annotations.GenericGenerator(name=<span class="code-quote">"hibernate-uuid"</span>, strategy=<span class="code-quote">"uuid"</span>)<br />@Table(name=<span class="code-quote">"CATEGORY"</span>)<br /><span class="code-keyword">public</span> class Category {<br /><br />	@Id<br />	@GeneratedValue(generator=<span class="code-quote">"hibernate-uuid"</span>)<br />	@Column(name=<span class="code-quote">"CATEGORY_ID"</span>)<br />	<span class="code-keyword">private</span> <span class="code-object">Long</span> id;<br /><br />	<span class="code-keyword">public</span> <span class="code-object">Long</span> getId() {<br />		<span class="code-keyword">return</span> id;<br />	}<br /><br />}</pre>
</div>
</div>
<ul>
<li>hibernate-uuid라는 이름으로 uuid 생성기를 사용하는 코드.</li>
</ul>
<ul>
<li>You aren't limited to the built-in strategies; you can<br />
create your own identifier generator by implementing Hibernate's<br />
IdentifierGenerator interface.</li>
</ul>

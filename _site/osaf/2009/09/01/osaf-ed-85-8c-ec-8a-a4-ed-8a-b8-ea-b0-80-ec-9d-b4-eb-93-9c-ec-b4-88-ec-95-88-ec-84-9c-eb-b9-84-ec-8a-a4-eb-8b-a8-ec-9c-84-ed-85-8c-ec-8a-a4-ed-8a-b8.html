<h1>서비스 단위 테스트</h1>
<p>DAO를 사용하지 않는 부분을 테스트 하거나, <br />
테스트 하려는 부분에서 사요하는 DAO 기능이 충분한 테스트를 거치지 않았거나, <br />
테스트에서 사용하는 DAO가 아직 제대로 구현되지 않았거나, <br />
실행이 오래 걸리는 DAO를 사용할 경우에 <br />
DAO를 목킹(mocking)하여 서비스 계층의 코드만 단위 테스트 할 수 있습니다.</p>
<h2><a name="서비스단위테스트-테스트하지않을것"></a>테스트 하지 않을 것</h2>
<p>DAO쪽으로 단순 위임하는 코드는 테스트하지 않습니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">	<span class="code-keyword">public</span> PurYearPlanDetail getPurYearPlanDetailById(<span class="code-object">int</span> detailid) {<br />
		<span class="code-keyword">return</span> dao.getPurYearPlanDetailById(detailid);<br />
	}<br />
</pre>
</div>
</div>
<h2><a name="서비스단위테스트-테스트할것"></a>테스트 할 것</h2>
<ul class="alternate" type="square">
<li>서비스 인터페이스에 새로 추가하고 구현한 메서드</li>
</ul>
<ul class="alternate" type="square">
<li>OSAF의 GenericService에서 상속받은 것을 재정의한 메서드</li>
</ul>
<p>OSAF의 GenericService에서 상속 받은 것 중에서 재정의한 메서드를 테스트 합니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">	<span class="code-keyword">public</span> void update(PurYearPlan entity) {<br />
		<span class="code-keyword">super</span>.update(entity);<br />
		entity.calcAll();<br />
	}<br />
</pre>
</div>
</div>
<ul class="alternate" type="square">
<li>비즈니스 로직</li>
</ul>
<p>서비스에 포함되어 있는 복잡한 비즈니스 로직을 테스트 합니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">	<span class="code-keyword">public</span> void addPurYearPlanDetail(<span class="code-object">int</span> yearplanid, PurYearPlanDetail detail) {<br />
		detail.calcAmount();<br />
		get(yearplanid).addDetail(detail);<br />
	}<br />
<br />	<span class="code-keyword">public</span> <span class="code-object">String</span> getAutoGeneratedCode(Date year) {<br />
		<span class="code-object">String</span> currentCode = <span class="code-keyword">null</span>;<br />
		SimpleDateFormat formatter = <span class="code-keyword">new</span> SimpleDateFormat(<span class="code-quote">"yyyy"</span>);<br />
		<span class="code-object">String</span> syear = formatter.format(year);<br />
		<br />
		<span class="code-object">String</span> previousCode = dao.getCurrentCode(year);<br />
		<span class="code-keyword">if</span> (previousCode != <span class="code-keyword">null</span>) {<br />
			<span class="code-object">Integer</span> currentNo = <span class="code-object">Integer</span>.valueOf(previousCode.substring(4)) + 1;<br />
			currentCode = (currentNo / 10) &gt; 0 ? syear + currentNo.toString()<br />
											   : syear + <span class="code-quote">"0"</span> + currentNo.toString();<br />
		} <span class="code-keyword">else</span> {<br />
			currentCode = syear + <span class="code-quote">"01"</span>;<br />
		}<br />
		<span class="code-keyword">return</span> currentCode;<br />
	}<br />
</pre>
</div>
</div>
<h2><a name="서비스단위테스트-테스트코드작성방법"></a>테스트 코드 작성 방법</h2>
<ul class="alternate" type="square">
<li>Mockito 러너 추가</li>
</ul>
<p>MockitoJUnitRunner를 추가합니다.</p>
<ul class="alternate" type="square">
<li>테스트 클래스 이름</li>
</ul>
<p>테스트 대상인 클래스 이름에 UnitTest를 붙여줍니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">@RunWith(MockitoJUnitRunner.class)<br />
<span class="code-keyword">public</span> class PurYearPlanServiceImplUnitTest {<br />
<br />}<br />
</pre>
</div>
</div>
<ul class="alternate" type="square">
<li>의존성 Mocking</li>
</ul>
<p>@Mock을 사용해서 의존하는 인터페이스에 대한 목 객체를 만들고, @Before를 붙인 setUp 메서드에서 테스트 객체에 주입해 줍니다.<br />
@Mock을 이용하면 mock(PurYearPlanDao.class); 같은 코드를 호출하지 않아도 MockitoJUnitRunner에 의해 자동으로 목 객체가 생성됩니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">@RunWith(MockitoJUnitRunner.class)<br />
<span class="code-keyword">public</span> class PurYearPlanServiceImplUnitTest {<br />
<br />	PurYearPlanServiceImpl service;<br />
	@Mock PurYearPlanDao mockDao;<br />
<br />	@Before<br />
	<span class="code-keyword">public</span> void setUp() {<br />
		service = <span class="code-keyword">new</span> PurYearPlanServiceImpl();<br />
		service.setDao(mockDao);<br />
	}<br />
...<br />
}<br />
</pre>
</div>
</div>
<ul class="alternate" type="square">
<li>테스트 작성</li>
</ul>
<p>테스테에 필요한 객체들을 정의하고 테스트 이후에 변경되는 값의 현재 상태를 확인합니다.<br />
Mockito의 stub()을 사용하여 목 객체가 어떻게 동작해야 하는지 정의해 줍니다.<br />
그런 다음 테스트 하려는 메서드를 실행합니다.<br />
마지막으로 비즈니스 로직이 제대로 수행되었는지 여러 객체의 상태들을 확입합니다.</p>
<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">	@Test<br />
	<span class="code-keyword">public</span> void addPurYearPlanDetail() <span class="code-keyword">throws</span> Exception {<br />
		PurYearPlan yearPlan = <span class="code-keyword">new</span> PurYearPlan();<br />
		<span class="code-object">int</span> yearplanid = 1;<br />
		yearPlan.setId(yearplanid);<br />
		PurYearPlanDetail detail = <span class="code-keyword">new</span> PurYearPlanDetail();<br />
		<br />
		when(mockDao.get(yearplanid)).thenReturn(yearPlan);<br />
		<br />
		service.addPurYearPlanDetail(yearplanid, detail);<br />
		assertThat(yearPlan.getDetails().size(), is(1));<br />
	}<br />
</pre>
</div>
</div>
<h2><a name="서비스단위테스트-생각해볼것"></a>생각해 볼 것</h2>
<ul class="alternate" type="square">
<li>목킹을 사용하는 여러 가지 경우를 좀 더 구체적으로 작성해야겠다.</li>
</ul>
